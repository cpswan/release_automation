name: dockerhub_sshnpd

on:
  workflow_dispatch:
  push:
    tags:
      - "t*.*.*"

permissions: # added using https://github.com/step-security/secure-workflows
  contents: read

jobs:
  prerelease_test:
    runs-on: ubuntu-latest
    steps:
      # Check for whether this is a pre-release
      - name: Check for pre-release
        run: |
          RELEASE_JSON=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/releases/latest")
          PRERELEASE=$(echo "$RELEASE_JSON" | jq -r '.prerelease')
          echo "PRERELEASE=${PRERELEASE}" >> $GITHUB_ENV
      - if: ${{ ! env.PRERELEASE }}
        name: Promote image to latest
        run: echo "Not a prerelease - do some work"
