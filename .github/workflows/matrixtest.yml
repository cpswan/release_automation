name: matrixtest

on:
  workflow_dispatch:

permissions: # added using https://github.com/step-security/secure-workflows
  contents: read

jobs:
  docker:
    strategy:
      matrix:
        os: [ubuntu-24.04-arm, ubuntu-24.04]
        name:
          - sshnpd
          - activate_sshnpd
          - sshnp_sshnpd
          - npt_sshnpd
          - sshnpd-slim
          - srvd
        include:
          - name: sshnpd
            dockerfile: ./packages/dart/sshnoports/tools/Dockerfile
          - name: activate_sshnpd
            dockerfile: ./packages/dart/sshnoports/tools/Dockerfile.activate
          - name: sshnp_sshnpd
            dockerfile: ./packages/dart/sshnoports/tools/Dockerfile.sshnp
          - name: npt_sshnpd
            dockerfile: ./packages/dart/sshnoports/tools/Dockerfile.npt
          - name: sshnpd-slim
            dockerfile: ./packages/dart/sshnoports/tools/Dockerfile.sshnpd-slim
          - name: srvd
            dockerfile: ./packages/dart/sshnoports/tools/Dockerfile.srvd
          - os: ubuntu-24.04-arm
            platforms: linux/arm64,linux/arm/v7
          - os: ubuntu-24.04
            platforms: linux/amd64
            prefix: amd64-
    runs-on: ${{ matrix.os }}
    steps:
      # Extract version and OS for docker tags
      - name: Get version
        run: |
          echo "VERSION=${GITHUB_REF##*/}" >> $GITHUB_ENV
          echo "Version: ${{ env.VERSION }}"
          echo "Current OS type: $OSTYPE"
          echo "Matrix OS: ${{ matrix.os}}"
          echo "Name: ${{ matrix.name }}"
          echo "Dockerfile: ${{ matrix.dockerfile }}"
          echo "Platforms: ${{ matrix.platforms }}"
          echo "Prefix ${{ matrix.prefix }}"
